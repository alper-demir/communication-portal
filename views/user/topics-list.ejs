<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head') %>

    <style>
        section:last-child {
            border: none;
        }
    </style>

    <body>
        <div class="flex flex-wrap dark:bg-[#343541]">
            <div class="z-10 w-full">
                <%- include('../partials/navbar') %>
            </div>

            <%- include('../partials/side') %>
                <div class="mt-8 flex-grow ml-64">
                    <div class="min-h-[85vh] mb-40 mt-20">

                        <div class="w-3/5 mx-auto border-2 border-indigo-400 dark:border-[#444654] rounded mt-5">
                            <% topics.forEach(topic=> { %>
                                <section
                                    class="flex justify-between border-b-2 border-indigo-400 dark:border-[#444654]">
                                    <div class="flex items-center dark:text-[#92959E] w-full">
                                        <!--Image and Username-->
                                        <div class="p-3 text-center w-[13rem]">
                                            <div class="flex flex-col items-center">
                                                <a href="/user/<%= topic.user.id %>"> <img
                                                        src="../../public/images/<%= topic.user.image %>" alt=""
                                                        class="object-cover h-12 w-12 rounded-full my-2 ring-2 dark:ring-sky-800 max-md:h-12 max-md:w-12 "></a>
                                                <span class="text-xs">
                                                    <a href="/user/<%= topic.user.id %>">
                                                        <%= topic.user.userName %>
                                                    </a>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="font-semibold flex flex-col w-full break-all mr-3">
                                            <a class="mt-6" href="/topic/<%= topic.id %>">
                                                <%= topic.title %>
                                            </a>
                                            <div class="flex mt-4 justify-between text-[1rem]">
                                                <!--creation time of topic-->
                                                <div>
                                                    <% const minutesAgo=Math.floor((Date.now() - new
                                                        Date(topic.createdAt)) / 1000 / 60); %>
                                                        <small class="mr-2">
                                                            <% if (minutesAgo < 1) { %>
                                                                Just now
                                                                <% } else if (minutesAgo < 60) { %>
                                                                    <%= minutesAgo %> minutes ago
                                                                        <% } else if (minutesAgo < 1440) { %>
                                                                            <%= Math.floor(minutesAgo / 60) %>
                                                                                hours
                                                                                ago
                                                                                <% } else { %>
                                                                                    <%= Math.floor(minutesAgo / 1440) %>
                                                                                        days ago
                                                                                        <% } %>
                                                        </small>

                                                </div>
                                                <!--last message time & user-->
                                                <div class="text-[1rem]">
                                                    <small>
                                                        <a href="/user/<%= topic.comments[0].user.id %>">
                                                            <%= topic.comments[0].user.userName %>
                                                        </a>
                                                        <span>
                                                            <% if (Math.floor((Date.now() - new Date(topic.updatedAt)) /
                                                                1000 / 60) < 1 ) { %>
                                                                <small class="mt-4 text-xs">just now</small>
                                                                <% } else if (Math.floor((Date.now() - new
                                                                    Date(topic.updatedAt)) / 1000 / 60) < 60 ) { %>
                                                                    <small class="mt-4 text-xs">
                                                                        <%= Math.floor((Date.now() - new
                                                                            Date(topic.updatedAt)) / 1000 / 60) %>
                                                                            minutes ago
                                                                    </small>
                                                                    <% } else if (Math.floor((Date.now() - new
                                                                        Date(topic.updatedAt)) / 1000 / 60 / 60) < 24) {
                                                                        %>
                                                                        <small class="mt-4 text-xs">
                                                                            <%= Math.floor((Date.now() - new
                                                                                Date(topic.updatedAt)) / 1000 / 60 / 60)
                                                                                %> hours ago
                                                                        </small>
                                                                        <% } else { %>
                                                                            <small class="mt-4 text-xs">
                                                                                <%= Math.floor((Date.now() - new
                                                                                    Date(topic.updatedAt)) / 1000 / 60 /
                                                                                    60 / 24) %> days ago
                                                                            </small>
                                                                            <% } %>
                                                        </span>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--views and messages-->
                                    <div class="dark:text-[#92959E]">
                                        <div
                                            class="flex flex-col justify-center pr-8 border-l-2 border-indigo-400 dark:border-[#444654] h-full">
                                            <div class="flex justify-between">
                                                <div class="px-4">Views:</div>
                                                <div>
                                                    <%= topic.views %>
                                                </div>
                                            </div>
                                            <div class="flex justify-between">
                                                <div class="px-4">Messages:</div>
                                                <div>
                                                    <%= topic.messages %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <% }) %>

                        </div>
                    </div>
                    <div>
                        <%- include('../partials/footer') %>
                    </div>
                </div>
        </div>
    </body>

</html>